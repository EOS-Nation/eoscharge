db.transaction_traces.aggregate([  
  {  
     $sort: {  
        _id: -1
     }
  },
  {  
     $limit: 100000
  },
  {  
     $unwind: {  
        path: "$action_traces",
        preserveNullAndEmptyArrays: false
     }
  },
  {  
     $project: {  
        cpu_usage_us: "$receipt.cpu_usage_us",
        net_usage_words: "$receipt.net_usage_words",
        action_acct: "$action_traces.act.account",
        action_name: "$action_traces.act.name"
     }
  },
  {
    "$group": {
      "_id": {
        "acct": "$action_acct",
        "name": "$action_name"
      },
      "avg_cpu_us": {
        "$avg": "$cpu_usage_us"
      },
      "avg_net_words": {
        "$avg": "$net_usage_words"
      },
      "count": {
        "$sum": 1
      }
    }
  },
  {
    "$out": "action_agg_results_100000"
  }
])
